@using System.Data;

@model System.Data.DataTable

@{
    ViewBag.Title = "Search";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="row">

    @foreach (DataRow row in Model.Rows)
    {
        <div class="col-lg-4 p-1">
            <div class="card h-100">
                <a class="card-body" href="@Url.Action("Display","Home",new { id = row["AttrationID"] })">

                    @if (row["Picture1"].ToString() == "")
                    {
                        <img src="~/photos/null.jpg" class="img-fluid mt-2" />
                    }
                    else
                    {
                        <img src="@row["Picture1"].ToString()" class="img-fluid mt-2" />
                    }

                    <div class="card-body">
                        <input type="hidden" value="@row["AttrationID"]" class="AID" />
                        <h6 class="text-dark">
                            <strong class="AName">@row["AttrationName"]"</strong>
                        </h6>
                        <p class="text-truncate text-dark Description" Address="@row["Address"]" Tel="@row["Tel"]" Px="@row["Px"]" Py="@row["Py"]" Picture1="@row["Picture1"]" Picdescribe1="@row["Picdescribe1"]" Ticketinfo="@row["Ticketinfo"]">
                            @row["Description"]
                        </p>
                    </div>
                </a>
                @if (Session["user"] != null)
                {
                    <div class="text-right">
                        <i class="bi bi-heart-fill text-danger mr-2 mb-2 addBookMark" style="font-size:2rem" data-toggle="tooltip" data-placement="bottom" title="加入書籤"></i>
                    </div>
                }
            </div>
        </div>
    }
</div>

@section scripts{
    <script>
        var bookmark = [];
        if (localStorage.getItem("bookmark")) {
            bookmark = JSON.parse(localStorage.getItem("bookmark"));
        }

        $('.addBookMark').click(function () {
            let attration = $(this).closest('.card');
            let newAID = attration.find('.AID').val();

            let foundItem = bookmark.find(item => item.AID == newAID);//找到or沒找到

            if (foundItem === undefined) {
                setBookMark(attration);
            }
            else {
                alert("該景點已在書籤中!!!");
            }

            localStorage.setItem("bookmark", JSON.stringify(bookmark));
        });

        function setBookMark(attration) {
            let newItem = {
                AID: attration.find('.AID').val(),
                AName: attration.find('.AName').text(),
                Address: attration.find('.Description').attr('Address'),
                Tel: attration.find('.Description').attr('Tel'),
                Px: attration.find('.Description').attr('Px'),
                Py: attration.find('.Description').attr('Py'),
                Picture1: attration.find('.Description').attr('Picture1'),
                Picdescribe1: attration.find('.Description').attr('Picdescribe1'),
                Ticketinfo: attration.find('.Description').attr('Ticketinfo'),
                Description: attration.find('.Description').text()
            };
            bookmark.push(newItem);
            alert("景點已加入書籤");
        }

        $(function () {
            $('[data-toggle="tooltip"]').tooltip()
        })
    </script>
    }

